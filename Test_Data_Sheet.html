<!DOCTYPE html>
<html lang="pl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test Data Sheet</title>
  <style>
    :root {
      --primary: #69727c;
      --primary-dark: #526ca3;
      --danger: #e74c3c;
      --success: #2ecc71;
      --gray-light: #f9f9f9;
      --gray: #ccc;
      --text-dark: #333;
      --bg-light: #ffffff;
      --font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    body {
      font-family: var(--font-family);
      background-color: var(--gray-light);
      color: var(--text-dark);
      margin: 0;
      padding: 20px;
    }

    h1 {
      font-size: 28px;
      margin-bottom: 20px;
      color: var(--primary-dark);
    }

    .tabs {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .tabs>div {
      margin-right: 5px;
    }

    .tab-button {
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 6px 6px 0 0;
      padding: 10px 16px;
      margin-right: 5px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
    }

    .tab-button.active {
      background-color: rgb(0, 0, 0);
      color: white;
      font-weight: bold;
      border: 1px solid var(--gray);
      border-bottom: none;
      text-decoration: underline;
      box-shadow: 0 0 8px rgba(82, 108, 163, 0.6);
      text-shadow: 0 0 3px rgba(82, 108, 163, 0.5);
    }

    .tab-button:hover {
      background-color: var(--primary-dark);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: var(--bg-light);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      border-radius: 6px;
      overflow: hidden;
    }

    th {
      background-color: var(--primary);
      color: white;
      font-weight: normal;
      padding: 12px;
      text-align: left;
      font-size: 13px;
    }

    td {
      padding: 10px;
      border-top: 1px solid var(--gray);
      vertical-align: top;
    }

    input[type="text"] {
      width: 100%;
      padding: 6px 10px;
      border: 1px solid var(--gray);
      border-radius: 4px;
      font-size: 13px;
      box-sizing: border-box;
      background-color: #fff;
      transition: all 0.2s ease-in-out;
    }

    input[type="text"]:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 2px rgba(45, 137, 239, 0.2);
    }

    input[readonly] {
      background-color: #f0f0f0;
      border-color: #ddd;
      color: #555;
    }

    .action-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
      margin-right: 6px;
      padding: 4px;
      transition: transform 0.1s ease;
    }

    .action-btn:hover {
      transform: scale(1.1);
    }

    .action-btn[title*="UsuÅ„"] {
      color: var(--danger);
    }

    .action-btn[title*="Zablokuj"] {
      color: #333;
    }

    .action-btn[title*="Odblokuj"] {
      color: var(--primary);
    }

    button.add-row,
    button.add-tab,
    button.export-json,
    button.import-json {
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 14px;
      margin: 10px 6px 10px 0;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
    }

    button.add-row:hover,
    button.add-tab:hover,
    button.export-json:hover,
    button.import-json:hover {
      background-color: var(--primary-dark);
    }

    input[type="file"] {
      display: none;
    }

    @media (max-width: 768px) {

      th,
      td {
        font-size: 12px;
      }

      .tab-button {
        padding: 8px 12px;
        font-size: 13px;
      }

      button {
        font-size: 13px;
        padding: 8px 12px;
      }
    }
  </style>

</head>

<body>

  <h1>Test Data Sheet</h1>

  <div class="tabs" id="tabs"></div>

  <div id="tab-contents"></div>

  <button class="add-tab" onclick="addTab()">+ Add new section</button>
  <button class="export-json" onclick="exportJSON()">ðŸ“¤ Save to JSON</button>
  <button class="import-json" onclick="document.getElementById('importFile').click()">ðŸ“¥ Load from JSON</button>
  <input type="file" id="importFile" accept=".json" onchange="importJSON(event)" />

  <script>
    let tabsData = [
      {
        name: 'Main page',
        rows: [
          { field: 'username', type: 'string', required: 'yes', examples: 'user123, testUser', boundary: 'min 5, max 15 chars', invalid: 'none, <5 characters, without whitespace characters', behavior: 'log in if the details are correct', editable: false },
          { field: 'password', type: 'string', required: 'yes', examples: 'Pass123!, qwerty123', boundary: 'min 8 chars and 1 digit', invalid: 'more than 8 chars', behavior: 'log in if the details are correct', editable: false }
        ]
      },
      {
        name: 'Login Page',
        rows: [
          { field: 'email', type: 'string', required: 'yes', examples: 'test@example.com', boundary: 'correct email', invalid: 'brak @, bez no @, no domain', behavior: 'register if your details are correct', editable: false },
          { field: 'birthdate', type: 'date', required: 'no', examples: '1990-01-01', boundary: 'past birthday', invalid: 'date of birth from the future', behavior: 'accept past dates', editable: false }
        ]
      }
    ];

    let currentTabIndex = 0;

    function renderTabs() {
      const tabsDiv = document.getElementById('tabs');
      tabsDiv.innerHTML = '';
      tabsData.forEach((tab, idx) => {
        const tabWrapper = document.createElement('div');
        tabWrapper.style.display = 'flex';
        tabWrapper.style.alignItems = 'center';

        const btn = document.createElement('button');
        btn.textContent = tab.name;
        btn.className = 'tab-button' + (idx === currentTabIndex ? ' active' : '');
        btn.onclick = () => {
          currentTabIndex = idx;
          renderTabs();
          renderTabContent();
        };

        const deleteBtn = document.createElement('button');
        deleteBtn.innerHTML = 'âœ–';
        deleteBtn.title = 'UsuÅ„ sekcjÄ™';
        deleteBtn.className = 'action-btn';
        deleteBtn.style.marginLeft = '4px';
        deleteBtn.style.color = '#e74c3c';
        deleteBtn.onclick = (e) => {
          e.stopPropagation(); // zapobiega klikniÄ™ciu zakÅ‚adki
          if (confirm(`Are you sure you want to delete the section? "${tab.name}"?`)) {
            tabsData.splice(idx, 1);
            currentTabIndex = Math.max(0, currentTabIndex - (idx <= currentTabIndex ? 1 : 0));
            renderTabs();
            renderTabContent();
          }
        };

        tabWrapper.appendChild(btn);
        tabWrapper.appendChild(deleteBtn);
        tabsDiv.appendChild(tabWrapper);
      });
    }

    function renderTabContent() {
      const container = document.getElementById('tab-contents');
      container.innerHTML = '';

      const tab = tabsData[currentTabIndex];

      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');

      ['Field Name', 'Data Type', 'Required', 'Example Values', 'Boundary Values', 'Invalid Examples', 'Expected Behavior', 'Actions'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);

      const tbody = document.createElement('tbody');

      tab.rows.forEach((row, idx) => {
        const tr = document.createElement('tr');

        ['field', 'type', 'required', 'examples', 'boundary', 'invalid', 'behavior'].forEach(key => {
          const td = document.createElement('td');
          const input = document.createElement('input');
          input.type = 'text';
          input.value = row[key];
          input.readOnly = !row.editable;
          input.style.width = '100%';
          input.onchange = (e) => {
            tabsData[currentTabIndex].rows[idx][key] = e.target.value;
          };

          // Dodajemy tooltip tylko dla wybranych pÃ³l
          if (['examples', 'boundary', 'invalid', 'behavior'].includes(key)) {
            input.title = row[key]; // Tooltip z aktualnÄ… wartoÅ›ciÄ…
          }

          td.appendChild(input);
          tr.appendChild(td);
        });

        // Akcje - blokada/odblokowanie + usuÅ„ wiersz
        const actionTd = document.createElement('td');

        // Przycisk blokady/odblokowania
        const lockBtn = document.createElement('button');
        lockBtn.className = 'action-btn';
        lockBtn.title = row.editable ? "Block edit" : "Unblock edit";
        lockBtn.innerHTML = row.editable ? 'ðŸ”“' : 'ðŸ”’';
        lockBtn.onclick = () => {
          tabsData[currentTabIndex].rows[idx].editable = !tabsData[currentTabIndex].rows[idx].editable;
          renderTabContent();
        };
        actionTd.appendChild(lockBtn);

        // Przycisk usuÅ„
        const delBtn = document.createElement('button');
        delBtn.className = 'action-btn';
        delBtn.title = 'Delete';
        delBtn.style.color = '#dc3545';
        delBtn.style.fontWeight = 'bold';
        delBtn.textContent = 'âœ–';
        delBtn.onclick = () => {
          if (confirm('Are you sure you want to delete this row?')) {
            tabsData[currentTabIndex].rows.splice(idx, 1);
            renderTabContent();
          }
        };
        actionTd.appendChild(delBtn);

        tr.appendChild(actionTd);

        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
      container.appendChild(table);

      const addRowBtn = document.createElement('button');
      addRowBtn.className = 'add-row';
      addRowBtn.textContent = '+ Add new row';
      addRowBtn.onclick = () => {
        tabsData[currentTabIndex].rows.push({
          field: '',
          type: '',
          required: '',
          examples: '',
          boundary: '',
          invalid: '',
          behavior: '',
          editable: true // nowy wiersz domyÅ›lnie odblokowany do edycji
        });
        renderTabContent();
      };
      container.appendChild(addRowBtn);
    }

    function addTab() {
      const newTabName = prompt('Enter a name for the new section (eg. Main page)');
      if (newTabName && newTabName.trim() !== '') {
        tabsData.push({ name: newTabName.trim(), rows: [] });
        currentTabIndex = tabsData.length - 1;
        renderTabs();
        renderTabContent();
      }
    }

    // Eksport do JSON
    function exportJSON() {
      const dataStr = JSON.stringify(tabsData, null, 2);
      const blob = new Blob([dataStr], { type: "application/json" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'test_data_sheet.json';
      a.click();

      URL.revokeObjectURL(url);
    }

    // Import z JSON
    function importJSON(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const importedData = JSON.parse(e.target.result);
          if (Array.isArray(importedData)) {
            // Ustawiamy editable: false dla wszystkich wierszy, jeÅ›li nie ma pola
            importedData.forEach(tab => {
              tab.rows.forEach(row => {
                if (typeof row.editable !== 'boolean') {
                  row.editable = false;
                }
              });
            });
            tabsData = importedData;
            currentTabIndex = 0;
            renderTabs();
            renderTabContent();
            alert("Import zakoÅ„czony sukcesem!");
          } else {
            alert("Niepoprawny format pliku JSON.");
          }
        } catch (err) {
          alert("BÅ‚Ä…d podczas wczytywania JSON: " + err.message);
        }
      };
      reader.readAsText(file);
      event.target.value = '';
    }

    // Initial render
    renderTabs();
    renderTabContent();
  </script>

</body>

</html>